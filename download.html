
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download Ready - Filmixo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ (‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; text-decoration: none; }
        body { background: #f0f2f5; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding: 20px 10px; }
        .download-container { width: 100%; max-width: 500px; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); padding: 30px; text-align: center; }
        .status-icon { color: #17bf63; font-size: 60px; margin-bottom: 20px; }
        .main-title { font-size: 26px; font-weight: 800; color: #0f1419; margin-bottom: 10px; }
        .sub-title { font-size: 16px; color: #536471; margin-bottom: 30px; line-height: 1.4; }
        .info-box { background: #e6f7ff; border: 1px solid #91d5ff; border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 14px; color: #0050b3; font-weight: 500; }
        .quality-buttons-container { display: flex; flex-direction: column; gap: 12px; margin-bottom: 25px; }
        .download-btn { display: flex; align-items: center; justify-content: center; width: 100%; padding: 15px 10px; border-radius: 8px; font-weight: bold; font-size: 16px; text-align: center; color: white; cursor: pointer; text-transform: uppercase; box-shadow: 0 3px 6px rgba(0,0,0,0.15); transition: transform 0.2s, background-color 0.2s; border: none; background: #1da1f2; /* ‡¶è‡¶ï‡¶ï ‡¶¨‡¶æ‡¶ü‡¶®, ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶∞‡¶Ç */ }
        .download-btn:active { transform: scale(0.98); box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .btn-icon { margin-right: 10px; }
        .footer-text { font-size: 12px; color: #aab8c2; margin-top: 15px; }
        .back-link { display: inline-block; margin-top: 15px; color: #1da1f2; font-weight: bold; font-size: 14px; }
        .loading-text { font-size: 16px; color: #1da1f2; }
    </style>
</head>
<body>

<div class="download-container">
    <div id="content-area">
        <div class="status-icon"><i class="fa-solid fa-spinner fa-spin"></i></div>
        <div class="main-title">Loading Download Link...</div>
        <div class="sub-title loading-text">Please wait while we prepare your file.</div>
    </div>
</div>

<script type="module">
    // --- ‡¶á‡¶â‡¶ü‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶∏ ---
    function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    async function getDownloadLink(postId) {
        try {
            const response = await fetch('posts.json');
            if (!response.ok) throw new Error("Failed to load posts data.");
            const posts = await response.json();
            
            const post = posts.find(p => p.id === postId);
            
            // üî• ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ 'downloadLink' ‡¶™‡ßç‡¶∞‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶ø‡¶ü‡¶ø ‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
            if (post && post.downloadLink) {
                return {
                    title: post.title,
                    link: post.downloadLink 
                };
            } else {
                return null;
            }
        } catch (error) {
            console.error("Error fetching download link:", error);
            return null;
        }
    }

    // --- ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶è‡¶ï‡¶ü‡¶ø ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®) ---
    function renderDownloadPage(postTitle, downloadLink) {
        const contentArea = document.getElementById('content-area');
        
        contentArea.innerHTML = `
            <div class="status-icon"><i class="fa-solid fa-circle-check"></i></div>
            <div class="main-title">${postTitle || "Your Download is Ready"}</div>
            <div class="sub-title">Click the button below to start your download.</div>
            
            <div class="info-box">
                <i class="fa-solid fa-circle-info"></i> Your download should start immediately.
            </div>

            <div class="quality-buttons-container">
                <a href="${downloadLink}" class="download-btn" target="_blank">
                    <i class="btn-icon fa-solid fa-download"></i> Start Download
                </a>
            </div>

            <div class="footer-text">
                Note: This link is direct and secure.
            </div>
            <a href="post.html?id=${getQueryParam('id')}" class="back-link">
                <i class="fa-solid fa-arrow-left"></i> Go Back to Post
            </a>
        `;
    }

    function renderErrorPage(message) {
        document.getElementById('content-area').innerHTML = `
            <div class="status-icon" style="color: #ff4d4f;"><i class="fa-solid fa-triangle-exclamation"></i></div>
            <div class="main-title">Download Error</div>
            <div class="sub-title" style="color: #ff4d4f;">${message}</div>
            <a href="index.html" class="back-link">
                <i class="fa-solid fa-house"></i> Go to Homepage
            </a>
        `;
    }

    // --- ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶® ---
    async function initDownload() {
        const postId = getQueryParam('id');

        if (!postId) {
            renderErrorPage("No Post ID found in the URL. Cannot locate download link.");
            return;
        }

        // üî• ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
        const data = await getDownloadLink(postId);

        if (data && data.link) {
            renderDownloadPage(data.title, data.link);
        } else {
            renderErrorPage(`Download link for Post ID: ${postId} could not be found in posts.json.`);
        }
    }

    initDownload();
</script>
</body>
</html>
