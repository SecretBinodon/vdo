
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Post Title - Secret Binodon</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* আপনার দেওয়া CSS স্টাইল */
        body { font-family: Arial, sans-serif; background: #f4f4f4; color: #333; padding: 20px; }
        .post-container { max-width: 700px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .post-title { color: #1da1f2; margin-bottom: 15px; }
        .post-meta { font-size: 12px; color: #777; margin-bottom: 20px; }
        .media-box { width: 100%; height: auto; margin-bottom: 20px; border-radius: 6px; overflow: hidden; }
        .media-box img { width: 100%; height: auto; display: block; }
        .post-content p { line-height: 1.6; margin-bottom: 15px; text-align: justify; }
        .download-btn-section { margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; }
        .download-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }
        .download-btn:hover { opacity: 0.9; }
        .download-btn i { margin-right: 10px; }
        
        /* বাটনের অবস্থার জন্য রঙ */
        .btn-ad-click { background: #1da1f2; } /* অ্যাড ভিজিটের জন্য */
        .btn-continue { background: #28a745; } /* কন্টিনিউ/ডাউনলোডের জন্য */
        .btn-loading { background: #ffc107; } /* লোডিং/অন্যান্য */
        .btn-continue:hover { background: #218838; }
        .btn-ad-click:hover { background: #0d8bd9; }

        /* স্পিনার স্টাইল */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

<div class="post-container" id="postContainer">
    <h1 class="post-title" id="postTitle">Loading Post...</h1>
    <div class="post-meta" id="postMeta"></div>
    
    <div class="media-box" id="mediaBox">
        <img id="mediaImage" src="" alt="Post Thumbnail">
    </div>

    <div class="post-content" id="postContent">
        <p>Loading content...</p>
    </div>

    <div class="download-btn-section">
        <button class="download-btn btn-ad-click" id="btn1080p" data-quality="1080p">
            <i class="fa-solid fa-cloud-arrow-down"></i> Download 1080p Full HD
        </button>
        <button class="download-btn btn-ad-click" id="btn720p" data-quality="720p">
            <i class="fa-solid fa-cloud-arrow-down"></i> Download 720p HD
        </button>
        <button class="download-btn btn-ad-click" id="btn480p" data-quality="480p">
            <i class="fa-solid fa-cloud-arrow-down"></i> Download 480p SD
        </button>
    </div>
</div>

<script>
    // --- কনফিগারেশন এবং গ্লোবাল স্টেট ---
    const AD_LINKS = [
        "https://adlink1.com/click",
        "https://adlink2.com/click",
        "https://adlink3.com/click",
        // এখানে আপনার সব অ্যাড লিংক যুক্ত করুন
    ];
    // localStorage ব্যবহার করে অ্যাড রোটেশন ইনডেক্স সেভ করা
    const AD_INDEX_KEY = 'sb_ad_rotation_index';
    // sessionStorage ব্যবহার করে এই পোস্টের জন্য অ্যাড ক্লিক হয়েছে কিনা, তা সেভ করা
    const POST_STATUS_KEY = 'sb_post_ad_status'; 

    let postId = null;
    let currentAdIndex = parseInt(localStorage.getItem(AD_INDEX_KEY)) || 0;
    
    // --- ইউটিলিটি ফাংশন ---
    
    // সমস্ত বাটনের অবস্থা আপডেট করা
    function updateAllButtons(isClicked) {
        const buttons = document.querySelectorAll('.download-btn-section .download-btn');
        buttons.forEach(btn => {
            if (isClicked) {
                // ২য় ক্লিক স্ট্যাটাস: কন্টিনিউ মোড
                btn.innerHTML = `<i class="fa-solid fa-arrow-right"></i> Continue to Download`;
                btn.classList.remove('btn-ad-click');
                btn.classList.add('btn-continue');
            } else {
                // ১ম ক্লিক স্ট্যাটাস: অ্যাড ভিজিট মোড
                const quality = btn.getAttribute('data-quality');
                btn.innerHTML = `<i class="fa-solid fa-cloud-arrow-down"></i> Download ${quality}`;
                btn.classList.remove('btn-continue');
                btn.classList.add('btn-ad-click');
            }
        });
    }

    // --- কোর লজিক: অ্যাড এবং ডাউনলোড হ্যান্ডলিং ---
    
    window.handleDownloadClick = function() {
        if (!postId) return;

        // এই পোস্টের জন্য স্ট্যাটাস লোড করা
        let status = JSON.parse(sessionStorage.getItem(POST_STATUS_KEY)) || {};
        let isAdClicked = status[postId] === true;
        
        if (!isAdClicked) {
            // --- প্রথম ক্লিক: অ্যাড ভিজিট ---
            
            // ১. অ্যাড লিংক নির্বাচন ও ভিজিট
            const adLink = AD_LINKS[currentAdIndex % AD_LINKS.length];
            window.open(adLink, '_blank');
            
            // ২. অ্যাড রোটেশন ইনডেক্স আপডেট
            currentAdIndex = (currentAdIndex + 1) % AD_LINKS.length; 
            localStorage.setItem(AD_INDEX_KEY, currentAdIndex);
            
            // ৩. সেশন স্ট্যাটাস আপডেট: ক্লিক হয়েছে
            status[postId] = true;
            sessionStorage.setItem(POST_STATUS_KEY, JSON.stringify(status));
            
            // ৪. UI আপডেট: কন্টিনিউ মোডে সেট করা
            updateAllButtons(true);
            
        } else {
            // --- দ্বিতীয় ক্লিক: ডাউনলোড পেজে রিডাইরেক্ট ---
            
            // ১. সেশন স্ট্যাটাস রিসেট (পরেরবার আবার অ্যাড ভিজিট করতে হবে)
            delete status[postId];
            sessionStorage.setItem(POST_STATUS_KEY, JSON.stringify(status));

            // ২. download.html এ রিডাইরেক্ট (এখানেই সংযোগ)
            // এটি user কে download.html?id=[Post ID] ঠিকানায় নিয়ে যাবে
            window.location.href = `download.html?id=${postId}`;
        }
    }
    
    // --- পেজ লোড এবং ডেটা লোড ---
    
    async function loadPostData() {
        // লোডিং স্পিনার ও টাইটেল সেট করা
        document.getElementById('postTitle').innerHTML = '<span class="spinner"></span> Loading Post...';
        
        try {
            const urlParams = new URLSearchParams(window.location.search);
            postId = urlParams.get('id');

            if (!postId) {
                document.getElementById('postTitle').innerText = "Error: Post ID Missing";
                return;
            }

            const res = await fetch('posts.json');
            if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
            const posts = await res.json();
            const post = posts.find(p => p.id === postId);

            if (!post) {
                document.getElementById('postTitle').innerText = "Error: Post Not Found";
                return;
            }

            // --- UI আপডেট ---
            document.getElementById('pageTitle').innerText = post.title + " - Secret Binodon";
            document.getElementById('postTitle').innerText = post.title;
            
            const uploadDate = post.uploadTime ? new Date(post.uploadTime).toLocaleDateString() : 'N/A';
            const duration = post.videoDuration || 'N/A';
            document.getElementById('postMeta').innerText = `Uploaded: ${uploadDate} | Duration: ${duration}`;

            if (post.mediaImage) document.getElementById('mediaImage').src = post.mediaImage;
            
            const contentDiv = document.getElementById('postContent');
            if (post.paragraphs && post.paragraphs.length > 0) {
                 contentDiv.innerHTML = post.paragraphs.map(p => `<p>${p}</p>`).join('');
            } else {
                contentDiv.innerHTML = '<p>No content available for this post.</p>';
            }
            
            // সকল বাটনে ইভেন্ট লিসেনার যোগ করা
            const buttons = document.querySelectorAll('.download-btn-section .download-btn');
            buttons.forEach(btn => {
                // তিনটি বাটনই একই ফাংশন কল করবে
                btn.addEventListener('click', handleDownloadClick); 
            });
            
            // প্রাথমিক অবস্থা সেট করা
            checkInitialState();


        } catch (error) {
            console.error("Error loading post data:", error);
            document.getElementById('postTitle').innerText = "Content Load Error";
            document.getElementById('postContent').innerHTML = `<p style="color:red;">Failed to load data. Check console for details.</p>`;
        }
    }

    // পেজ লোড বা রিফ্রেশ হলে বাটনের অবস্থা চেক করা
    function checkInitialState() {
        if (!postId) return;
        let status = JSON.parse(sessionStorage.getItem(POST_STATUS_KEY)) || {};
        let isAdClicked = status[postId] === true;
        
        // অ্যাড ক্লিক হয়ে থাকলে কন্টিনিউ মোডে সেট করা
        updateAllButtons(isAdClicked);
    }
    
    // DOM লোড হওয়ার পর শুরু করা
    document.addEventListener('DOMContentLoaded', () => {
        loadPostData();
    });

    // ব্রাউজার ব্যাক বাটন প্রেস করার পর BFCache থেকে লোড হলে (যাতে অবস্থা ঠিক থাকে)
    window.addEventListener('pageshow', (event) => {
        if (event.persisted) {
             checkInitialState();
        }
    });
    
</script>

</body>
</html>
