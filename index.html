
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Binodon - Home</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- ‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; text-decoration: none; }
        body { background: #fff; display: flex; justify-content: center; }

        /* ‚úÖ ‡¶Æ‡ßÇ‡¶≤ ‡¶≤‡ßá‡¶Ü‡¶â‡¶ü ‡¶®‡¶ø‡¶Ø‡¶º‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£: ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶®‡¶æ ‡¶π‡¶ì‡ßü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶Ö‡¶¶‡ßÉ‡¶∂‡ßç‡¶Ø */
        .main-wrapper { 
            width: 100%; 
            max-width: 600px; 
            min-height: 100vh; 
            background: #fff; 
            position: relative; 
            border-left: 1px solid #eee; 
            border-right: 1px solid #eee; 
            padding-bottom: 0; 
            opacity: 0; 
        }
        
        /* ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶§‡¶æ‡ßé‡¶ï‡ßç‡¶∑‡¶£‡¶ø‡¶ï ‡¶¶‡ßÉ‡¶∂‡ßç‡¶Ø‡¶Æ‡¶æ‡¶®‡¶§‡¶æ */
        .main-wrapper.loaded { opacity: 1 !important; }

        /* ‡¶π‡ßá‡¶°‡¶æ‡¶∞ */
        header { 
            background: #1da1f2; padding: 12px 15px; display: flex; justify-content: space-between; 
            align-items: center; color: white; position: sticky; top: 0; z-index: 100; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
        }
        .logo-area { font-weight: 800; font-size: 20px; text-transform: uppercase; }
        .header-btn { background: white; color: #1da1f2; padding: 6px 15px; border-radius: 20px; font-weight: bold; font-size: 14px; margin-left: 10px; cursor: pointer; }

        /* ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶° */
        .post-card { 
            background: white; padding: 15px; border-bottom: 1px solid #e1e8ed; 
            display: flex; flex-direction: column; 
            gap: 6px; 
        }

        .post-header { display: flex; gap: 10px; align-items: center; }
        .post-pfp { width: 45px; height: 45px; border-radius: 50%; overflow: hidden; background: #ddd; }
        .post-pfp img { width: 100%; height: 100%; object-fit: cover; }
        .post-meta-text { display: flex; flex-direction: column; justify-content: center; }
        .name-row { display: flex; align-items: center; gap: 5px; flex-wrap: wrap; }
        
        .name-row h3 { font-size: 18px; font-weight: 800; color: #0f1419; margin: 0; }
        
        .post-username { font-size: 14px; color: #536471; }
        
        .time-ago { font-size: 15px; color: #536471; }
        .dot-separator { font-size: 15px; color: #536471; margin: 0 2px; }

        .clickable-area { cursor: pointer; }
        
        .post-title { 
            font-size: 18px; 
            font-weight: 700; 
            color: #0f1419; 
            margin-bottom: 8px; 
            margin-top: -3px; 
            line-height: 1.3; 
        }
        
        .post-excerpt { font-size: 15px; color: #0f1419; line-height: 1.4; margin-bottom: 8px; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; }
        .read-more-text { color: #1da1f2; font-weight: 600; font-size: 14px; }
        .hashtags { color: #1d9bf0; font-size: 15px; margin-bottom: 10px; cursor: default; }

        /* üî• ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶á‡¶Æ‡ßá‡¶ú ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ üî• */
        .media-container { 
            position: relative; 
            width: 100%; 
            border-radius: 12px; 
            overflow: hidden;
            margin-top: 5px; 
            display: block; 
            cursor: pointer; 
            background: #000;
            
            /* ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü: ‡¶≤‡¶Æ‡ßç‡¶¨‡¶æ ‡¶á‡¶Æ‡ßá‡¶ú (‡¶Ø‡ßá‡¶Æ‡¶® 9:16) ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø 3:4 ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∏‡¶™‡ßá‡¶ï‡ßç‡¶ü ‡¶∞‡ßá‡¶∂‡¶ø‡¶ì */
            aspect-ratio: 3 / 4; 
            max-height: 720px; 
        }
        
        .media-container img { 
            width: 100%; 
            height: 100%; /* ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞‡ßá‡¶∞ ‡¶™‡ßÅ‡¶∞‡ßã ‡¶π‡¶æ‡¶á‡¶ü ‡¶®‡ßá‡¶¨‡ßá */
            display: block; 
            /* 9:16 ‡¶á‡¶Æ‡ßá‡¶ú‡ßá‡¶∞ ‡¶â‡¶™‡¶∞‡ßá-‡¶®‡¶ø‡¶ö‡ßá ‡¶Ö‡¶Ç‡¶∂ ‡¶ï‡¶æ‡¶ü‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø */
            object-fit: cover; 
            margin: 0 auto; 
            max-height: none; 
        }
        
        /* ‡¶ö‡¶ì‡¶°‡¶º‡¶æ ‡¶¨‡¶æ ‡¶∏‡ßç‡¶ï‡ßã‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶ú (‡¶Ø‡ßá‡¶Æ‡¶® 16:9, 1:1, 4:3) ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø */
        .media-container.auto-fit {
            aspect-ratio: initial; /* 3:4 ‡¶∞‡ßá‡¶∂‡¶ø‡¶ì ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã */
            height: auto; 
        }
        .media-container.auto-fit img { 
            height: auto; /* ‡¶á‡¶Æ‡ßá‡¶ú ‡¶§‡¶æ‡¶∞ ‡¶Ü‡¶∏‡¶≤ ‡¶π‡¶æ‡¶á‡¶ü ‡¶®‡ßá‡¶¨‡ßá */
            object-fit: contain; /* ‡¶á‡¶Æ‡ßá‡¶ú ‡¶™‡ßÅ‡¶∞‡ßã‡¶ü‡¶æ ‡¶¶‡ßÉ‡¶∂‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® ‡¶π‡¶¨‡ßá, ‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡¶Ç‡¶∂ ‡¶ï‡¶æ‡¶ü‡¶¨‡ßá ‡¶®‡¶æ */
        }
        /* üî• ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶á‡¶Æ‡ßá‡¶ú ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ ‡¶∂‡ßá‡¶∑ üî• */

        .play-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; background-color: rgba(0, 0, 0, 0.6); border-radius: 50%; display: flex; justify-content: center; align-items: center; pointer-events: none; border: 2px solid rgba(255,255,255,0.8); }
        .play-icon::after { content: ''; display: block; width: 0; height: 0; border-left: 18px solid white; border-top: 11px solid transparent; border-bottom: 11px solid transparent; margin-left: 4px; }
        .duration-badge { position: absolute; bottom: 8px; right: 8px; background-color: rgba(0, 0, 0, 0.8); color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; pointer-events: none; z-index: 5; }

        .post-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; color: #536471; font-size: 16px; font-weight: 500; }
        .footer-left { display: flex; align-items: center; gap: 6px; }
        .footer-right { display: flex; align-items: center; gap: 20px; }
        
        .love-btn-rel { cursor: pointer; display: flex; align-items: center; gap: 5px; transition: all 0.2s; user-select: none; }
        .love-btn-rel:hover { color: #e0245e; background-color: rgba(224, 36, 94, 0.1); padding: 4px 8px; border-radius: 15px; margin: -4px -8px; }
        .love-btn-rel.liked { color: #e0245e !important; } .love-btn-rel.liked i { font-weight: 900; }
        .footer-share-btn { cursor: pointer; padding: 8px; border-radius: 50%; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; }
        .footer-share-btn:hover { background-color: rgba(0,0,0,0.05); }

        /* ‡¶´‡ßÅ‡¶ü‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶≤‡ßã‡¶°‡¶æ‡¶∞ */
        .site-footer { background-color: #fff; padding: 30px 20px; text-align: center; border-top: 1px solid #e1e8ed; margin-top: 10px; }
        .footer-links { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 15px; }
        .footer-links a { color: #536471; font-size: 14px; font-weight: 500; transition: color 0.2s; }
        .footer-links a:hover { color: #1da1f2; text-decoration: underline; }
        .footer-copyright { color: #536471; font-size: 13px; }
        .footer-copyright a { color: #1da1f2; font-weight: bold; }
        
        .spinner { width: 14px; height: 14px; border: 2px solid #ccc; border-top: 2px solid #000; border-radius: 50%; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .notification { position: fixed; top: 70px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); color: white; padding: 10px 20px; border-radius: 30px; z-index: 1002; opacity: 0; transition: 0.3s; pointer-events: none; }
        .notification.show { opacity: 1; }

        /* Infinite Scroll Sentinel */
        #sentinel { width: 100%; height: 50px; display: flex; align-items: center; justify-content: center; }
        .load-more-spinner { width: 24px; height: 24px; border: 3px solid #ccc; border-top: 3px solid #1da1f2; border-radius: 50%; animation: spin 1s linear infinite; display: none; }
        #sentinel.loading .load-more-spinner { display: block; }
    </style>
</head>
<body>

<div class="main-wrapper">
    <header>
        <div class="logo-area">SECRET BINODON</div>
        <div>
            <span class="header-btn" onclick="window.location.href='https://www.example.com/signup'">Sign Up</span>
            <span class="header-btn" onclick="window.location.href='index.html'">Home</span>
        </div>
    </header>

    <div id="posts-container">
        </div>

    <div id="sentinel"><div class="load-more-spinner"></div></div>

    <footer class="site-footer">
        <div class="footer-links">
            <a href="#" id="link-about">About</a>
            <a href="#" id="link-contact">Contact</a>
            <a href="#" id="link-privacy">Privacy Policy</a>
            <a href="#" id="link-terms">Terms of Service</a>
        </div>
        <div class="footer-copyright">
            Copyright ¬© 2025 <a href="index.html">SecretBinodon.com</a>. All rights reserved.
        </div>
    </footer>
    <div id="notification" class="notification"></div>
</div>

<script type="module">
    // Firebase SDK Imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, increment, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

    // ============================================
    //  ‡ßß. ‡¶∏‡ßç‡¶•‡¶æ‡ßü‡ßÄ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶á‡¶Æ‡ßá‡¶ú URL ‡¶è‡¶¨‡¶Ç Firebase Configuration
    // ============================================
    const PERMANENT_PROFILE_IMAGE_URL = "https://raw.githubusercontent.com/SecretBinodon/vdo/refs/heads/main/Image%20Files/secretbinodon.jpg";

    const firebaseConfig = { apiKey: "AIzaSyCAsD8wucLsudzY5oNbiixLGyjN2apdV0Q", authDomain: "my-ad-analytics-4560a.firebaseapp.com", databaseURL: "https://my-ad-analytics-4560a-default-rtdb.firebaseio.com", projectId: "my-ad-analytics-4560a", storageBucket: "my-ad-analytics-4560a.firebasestorage.app", messagingSenderId: "104213283950", appId: "1:104213283950:web:b5a25ecd54df809625127f", measurementId: "G-WS7QSQ9H0Y" };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const deviceId = localStorage.getItem('deviceId') || 'device-'+Date.now(); 

    // ============================================
    //  CONFIGURATION (‡¶á‡¶®‡¶´‡¶ø‡¶®‡¶ø‡¶ü‡¶ø ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤)
    // ============================================
    const CONFIG = {
        BATCH_SIZE_INITIAL: 10, /* ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶≤‡ßã‡¶°‡ßá ‡¶ï‡¶§‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶•‡¶æ‡¶ï‡¶¨‡ßá (‡¶Ø‡ßá‡¶Æ‡¶® ‡ß®‡ß¶) */
        BATCH_SIZE_SCROLL: 5,  /* ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¨‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶ï‡¶§‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá (‡¶Ø‡ßá‡¶Æ‡¶® ‡ß´) */
        footer: { about: "#", contact: "#", privacy: "#", terms: "#" }
    };

    document.getElementById('link-about').href = CONFIG.footer.about;
    document.getElementById('link-contact').href = CONFIG.footer.contact;
    document.getElementById('link-privacy').href = CONFIG.footer.privacy;
    document.getElementById('link-terms').href = CONFIG.footer.terms;

    // ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤
    let allPosts = []; // ‡¶Æ‡ßã‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶™‡ßã‡¶∏‡ßç‡¶ü
    let currentStartIndex = 0; // ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡¶§‡¶ó‡ßÅ‡¶≤‡ßã ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ‡¶§‡¶æ‡¶∞ ‡¶á‡¶®‡ßç‡¶°‡ßá‡¶ï‡ßç‡¶∏
    let isLoading = false; // ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶®‡¶ø‡¶Ø‡¶º‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£
    let sentinelObserver; // ‡¶á‡¶®‡¶´‡¶ø‡¶®‡¶ø‡¶ü‡¶ø ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶°‡¶ø‡¶ü‡ßá‡¶ï‡ßç‡¶ü‡¶∞

    // üî• ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∞‡ßá üî•
    let timeElementsToUpdate = [];

    
    // --- ‡¶á‡¶â‡¶ü‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶∏ ---
    function getRandomColor() { const c=['#e0245e','#17bf63','#1da1f2','#ffad1f','#794bc4']; return c[Math.floor(Math.random()*c.length)]; }
    function formatCount(n) { if(!n) return 0; return n >= 1000000 ? (n/1000000).toFixed(1)+'M' : n >= 1000 ? (n/1000).toFixed(1)+'K' : n; }
    
    // üî• ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ timeAgo() ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®: ‡¶è‡¶ü‡¶ø ‡¶è‡¶ñ‡¶® ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶® ‡¶ï‡¶∞‡ßá üî•
    function timeAgo(dateString) { 
        const d = new Date(dateString);
        const seconds = Math.floor((new Date() - d) / 1000);
        
        let interval = seconds / 31536000;
        if (interval > 1) return Math.floor(interval) + "y ago";
        
        interval = seconds / 86400;
        if (interval > 1) return Math.floor(interval) + "d ago";
        
        interval = seconds / 3600;
        if (interval > 1) return Math.floor(interval) + "h ago";
        
        interval = seconds / 60;
        if (interval > 1) return Math.floor(interval) + "m ago";
        
        return "Just now";
    }

    // üî• ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®: ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ üî•
    function updateAllTimeElements() {
        timeElementsToUpdate.forEach(item => {
            if (item.element && item.element.parentNode) {
                 // element ‡¶Ø‡¶¶‡¶ø DOM ‡¶è ‡¶è‡¶ñ‡¶®‡¶ì ‡¶•‡¶æ‡¶ï‡ßá
                item.element.innerText = timeAgo(item.dateString);
            } else {
                // element ‡¶Ø‡¶¶‡¶ø DOM ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠ ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡ßü, ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∞‡ßá ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡¶æ‡¶¶ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ
                timeElementsToUpdate = timeElementsToUpdate.filter(i => i !== item);
            }
        });
    }

    function formatDate(d) { return new Date(d).toLocaleDateString('en-US', { year:'numeric', month:'short', day:'numeric' }); }
    function showNotification(msg) { const n=document.getElementById('notification'); n.innerText=msg; n.classList.add('show'); setTimeout(()=>n.classList.remove('show'),3000); }

    // üî• ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®: ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶á‡¶Æ‡ßá‡¶ú‡ßá‡¶∞ ‡¶Ü‡¶∏‡¶≤ ‡¶°‡¶æ‡¶á‡¶Æ‡ßá‡¶®‡¶∂‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ üî•
    function adjustImageAspectRatio(imgElement) {
        const mediaContainer = imgElement.closest('.media-container');
        
        imgElement.onload = function() {
            const originalWidth = this.naturalWidth;
            const originalHeight = this.naturalHeight;
            
            // W/H ‡¶∞‡ßá‡¶∂‡¶ø‡¶ì: 3:4 = 0.75, 1:1 = 1.0, 16:9 = 1.777
            const ratio = originalWidth / originalHeight;
            
            // ‡¶Ø‡¶¶‡¶ø ‡¶á‡¶Æ‡ßá‡¶ú‡ßá‡¶∞ W/H ‡¶∞‡ßá‡¶∂‡¶ø‡¶ì 3/4 (0.75) ‡¶è‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶¨‡ßá‡¶∂‡¶ø ‡¶¨‡¶æ ‡¶∏‡¶Æ‡¶æ‡¶® ‡¶π‡¶Ø‡¶º (‡¶Ö‡¶∞‡ßç‡¶•‡¶æ‡ßé ‡¶ö‡¶ì‡ßú‡¶æ ‡¶¨‡¶æ ‡¶∏‡ßç‡¶ï‡ßã‡ßü‡¶æ‡¶∞), 
            // ‡¶§‡¶¨‡ßá ‡¶è‡¶ü‡¶ø ‡¶Ö‡¶∞‡¶ø‡¶ú‡¶ø‡¶®‡¶æ‡¶≤ ‡¶∏‡¶æ‡¶á‡¶ú‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá‡•§
            if (ratio >= (3 / 4)) { 
                mediaContainer.classList.add('auto-fit');
            } else {
                // ‡¶Ø‡¶¶‡¶ø 3:4 ‡¶è‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶≤‡¶Æ‡ßç‡¶¨‡¶æ ‡¶π‡ßü (‡¶Ø‡ßá‡¶Æ‡¶® 9:16 = 0.5625), 
                // ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü 3:4 ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç object-fit: cover ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§
                mediaContainer.classList.remove('auto-fit');
            }
        };

        if (imgElement.complete) {
            imgElement.onload();
        }
    }

    // ==================================================
    //  ‚úÖ ‡¶á‡¶®‡¶ø‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡ßç‡¶∞‡¶ø‡¶™‡¶æ‡¶∞‡ßá‡¶∂‡¶®
    // ==================================================
    async function init() {
        const postsContainer = document.getElementById('posts-container');
        const mainWrapper = document.querySelector('.main-wrapper'); 
        
        try {
            const res = await fetch('posts.json');
            if(!res.ok) throw new Error("Failed to load posts data.");
            const posts = await res.json();
            
            // ‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶ó‡ßÅ‡¶≤‡ßã‡¶ï‡ßá ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã (‡¶®‡¶§‡ßÅ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã)
            allPosts = posts.sort((a, b) => new Date(b.uploadTime) - new Date(a.uploadTime));
            
            // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ (INITIAL BATCH)
            loadNextBatch(CONFIG.BATCH_SIZE_INITIAL);
            
            // ‡¶á‡¶®‡¶´‡¶ø‡¶®‡¶ø‡¶ü‡¶ø ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶°‡¶ø‡¶ü‡ßá‡¶ï‡ßç‡¶ü‡¶∞ ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ ‡¶ï‡¶∞‡¶æ
            setupSentinelObserver();
            
            // ‡¶™‡ßá‡¶ú ‡¶¶‡ßÉ‡¶∂‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ
            mainWrapper.classList.add('loaded');

            // üî• ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶á‡¶®‡¶ü‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶≤ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ üî•
            setInterval(updateAllTimeElements, 60000); // ‡¶™‡ßç‡¶∞‡¶§‡¶ø 60 ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü

        } catch (e) { 
            postsContainer.innerHTML = `<div style="padding:20px;text-align:center;color:red;">Error loading posts: ${e.message}</div>`; 
            mainWrapper.classList.add('loaded'); 
        }
    }

    /**
     * ‡¶á‡¶®‡¶´‡¶ø‡¶®‡¶ø‡¶ü‡¶ø ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤‡¶ø‡¶Ç ‡¶°‡¶ø‡¶ü‡ßá‡¶ï‡ßç‡¶ü‡¶∞ ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™‡•§
     */
    function setupSentinelObserver() {
        const sentinel = document.getElementById('sentinel');
        sentinelObserver = new IntersectionObserver((entries) => {
            if (entries[0].isIntersecting && !isLoading) {
                // ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶ï‡¶∞‡ßá ‡¶∏‡ßá‡¶®‡¶ü‡¶ø‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶ï‡¶æ‡¶õ‡¶æ‡¶ï‡¶æ‡¶õ‡¶ø ‡¶ó‡ßá‡¶≤‡ßá ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá
                setTimeout(() => loadNextBatch(CONFIG.BATCH_SIZE_SCROLL), 300); 
            }
        }, { rootMargin: '100px' });
        
        sentinelObserver.observe(sentinel);
    }
    
    // ==================================================
    //  ‚úÖ ‡¶á‡¶®‡¶´‡¶ø‡¶®‡¶ø‡¶ü‡¶ø ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤‡¶ø‡¶Ç ‡¶≤‡¶ú‡¶ø‡¶ï
    // ==================================================

    function loadNextBatch(batchSize) { 
        const sentinel = document.getElementById('sentinel');
        
        // 1. ‡¶∂‡ßá‡¶∑ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ
        if (currentStartIndex >= allPosts.length) {
            sentinel.style.display = 'none'; 
            if(sentinelObserver) sentinelObserver.unobserve(sentinel);
            return;
        }

        isLoading = true;
        sentinel.classList.add('loading');
        
        // ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßã‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶á‡¶®‡ßç‡¶°‡ßá‡¶ï‡ßç‡¶∏ ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶£
        const endIndex = Math.min(currentStartIndex + batchSize, allPosts.length);
        const postsToLoad = allPosts.slice(currentStartIndex, endIndex);

        renderBatch(postsToLoad); 
        
        // ‡¶á‡¶®‡ßç‡¶°‡ßá‡¶ï‡ßç‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        currentStartIndex = endIndex;

        isLoading = false;
        sentinel.classList.remove('loading');
        
        // 2. ‡¶≤‡ßã‡¶° ‡¶∂‡ßá‡¶∑‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶∂‡ßá‡¶∑ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ
        if (currentStartIndex >= allPosts.length) {
            sentinel.style.display = 'none';
            if(sentinelObserver) sentinelObserver.unobserve(sentinel);
        }
    }

    // ==================================================
    //  ‚úÖ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    // ==================================================

    function renderBatch(postsToLoad) {
        const container = document.getElementById('posts-container');
        
        postsToLoad.forEach(post => {
            let excerpt = post.paragraphs[0].substring(0, 200) + "...";
            const safeTitle = post.title.replace(/'/g, "\\'");
            
            const cardWrapper = document.createElement('div');
            cardWrapper.innerHTML = `
                <div class="post-card" data-id="${post.id}">
                    <div class="post-header">
                        <div class="post-pfp"><img src="${PERMANENT_PROFILE_IMAGE_URL}" loading="lazy"></div>
                        <div class="post-meta-text">
                            <div class="name-row">
                                <h3>Secret Binodon</h3>
                                <span class="post-username">@SecretBinodon</span>
                                <span class="dot-separator">¬∑</span>
                                <span class="time-ago" data-upload-time="${post.uploadTime}">${timeAgo(post.uploadTime)}</span>
                            </div>
                        </div>
                    </div>
                    <div class="clickable-area" onclick="openPost('${post.id}')">
                        <div class="post-title">${post.title}</div>
                        <div class="post-excerpt">${excerpt} <span class="read-more-text">See more</span></div>
                    </div>
                    <div class="hashtags">${post.hashtags}</div>
                    <div class="clickable-area" onclick="openPost('${post.id}')">
                        <div class="media-container">
                            <img src="${post.mediaImage}" loading="lazy">
                            <div class="play-icon"></div>
                            <div class="duration-badge">${post.videoDuration}</div>
                        </div>
                    </div>
                    <div class="post-footer">
                        <div class="footer-left">
                            <i class="fa-solid fa-chart-simple"></i> <span class="count-text view-count-rel">...</span> <span class="label-text">Views</span>
                        </div>
                        <div class="footer-right">
                            <div class="love-btn-rel"><i class="fa-regular fa-heart"></i> <span class="count-text like-count-rel">...</span> <span class="label-text">Likes</span></div>
                            <div class="post-date-display">${formatDate(post.uploadTime)}</div>
                            <div class="footer-share-btn" onclick="sharePost('${post.id}', '${safeTitle}')"><i class="fa-solid fa-share-from-square"></i></div>
                        </div>
                    </div>
                </div>`;
            
            const newCard = cardWrapper.firstElementChild;
            container.appendChild(newCard);

            // ‡¶á‡¶Æ‡ßá‡¶ú ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ú‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü
            const imgElement = newCard.querySelector('.media-container img');
            adjustImageAspectRatio(imgElement);

            // üî• ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ üî•
            const timeElement = newCard.querySelector('.time-ago');
            if (timeElement) {
                timeElementsToUpdate.push({
                    element: timeElement,
                    dateString: post.uploadTime
                });
            }

            setupFirebaseForCard(newCard, post.id);
        });
    }

    function setupFirebaseForCard(card, id) {
        const vEl = card.querySelector('.view-count-rel'), lEl = card.querySelector('.like-count-rel'), lBtn = card.querySelector('.love-btn-rel');
        onSnapshot(doc(db, "views", id), s => vEl.innerText = formatCount(s.data()?.count || 0));
        const lRef = doc(db, "loves", id), uRef = doc(db, `loves/${id}/users`, deviceId);
        onSnapshot(lRef, s => lEl.innerText = formatCount(s.data()?.count || 0));
        getDoc(uRef).then(s => { if(s.exists()) { lBtn.classList.add('liked'); lBtn.querySelector('i').classList.replace('fa-regular','fa-solid'); } });
        lBtn.addEventListener('click', async () => { if((await getDoc(uRef)).exists()) showNotification("Already Liked! ‚ù§Ô∏è"); else { lBtn.classList.add('liked'); lBtn.querySelector('i').classList.replace('fa-regular','fa-solid'); await setDoc(lRef, { count: increment(1) }, { merge: true }); await setDoc(uRef, { t: new Date() }); showNotification("Liked! ‚ù§Ô∏è"); } });
    }

    window.openPost = (id) => window.location.href = `post.html?id=${id}`;
    window.sharePost = (id, title) => { const url = window.location.origin + `/vdo/post.html?id=${id}`; if (navigator.share) { navigator.share({ title: title, text: title, url: url }).catch((e) => console.log('Share failed', e)); } else { navigator.clipboard.writeText(url); showNotification("Link copied! üìã"); } }

    init();
</script>
</body>
</html>
