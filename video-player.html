<!doctype html>
<html lang="bn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Video Play Page</title>
    <meta name="description" content="ভাইরাল ভিডিওটি উপভোগ করুন।" />
    
    <script type='text/javascript' src='//pl27703154.revenuecpmgate.com/70/2c/67/702c67f9d1db58564142cc27691530f9.js'></script>
    <link href="https://fonts.googleapis.com/css2?family=Fugaz+One&display=swap" rel="stylesheet">
    
    <style>
    /*======================================
     সাধারণ স্টাইল (মোবাইল ও ডেস্কটপ উভয়ের জন্য)
    ======================================*/
    :root {
        --bg-primary: #121212;
        --bg-secondary: #1e1e1e;
        --text-primary: #e0e0e0;
        --text-secondary: #aaaaaa;
        --text-link: #3498db; 
        --card-bg: #2d2d2d; 
        --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        --card-hover-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
        --divider-color: #444444;
        --category-bg: #3a3a3a;
        --category-text: #e0e0e0;
        --modal-bg: #2d2d2d;
        --input-bg: #444444;
        --input-border: #555555;
        --footer-bg: #1e1e1e;
    }

    .ad-container {
      width: 100%;
      box-sizing: border-box;
      margin-top: 0px;
      margin-bottom: 0px;
      text-align: center;
    }

    html, body {
        overflow-x: hidden;
        margin: 0;
        padding: 0;
        min-height: 100%; 
        font-family: sans-serif; 
        background-color: var(--bg-primary); 
        color: var(--text-primary); 
        position: relative;
    }
    
    .header {
        background: linear-gradient(to right, #6a11cb 0%, #2575fc 100%);
        color: #fff;
        padding: 10px 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
        display: flex;
        justify-content: space-between; 
        align-items: center;
        gap: 10px;
        position: sticky; top:0; z-index:50;
    }
    .header-left {
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 0;
    }
    .website-icon {
        width: 25px; 
        height: 25px;
    }
    .website-icon svg {
        fill: #fff;
        width: 100%;
        height: 100%;
    }
    .website-name {
        font-size: 20px;
        font-weight: 400; 
        font-family: 'Fugaz One', cursive; 
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .name-part-1 {
        color: #FFD700; 
    }
    .name-part-2 {
        color: #fff; 
    }
    .header-right {
        display: flex;
        align-items: center;
        gap: 10px; 
        flex-shrink: 0; 
    }
    .social-icons-container {
        display: flex;
        gap: 5px; 
    }
    .social-icon {
        display: block;
        width: 25px; 
        height: 25px;
        transition: transform 0.2s ease;
    }
    .social-icon img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
    }
    .social-icon:hover {
        transform: scale(1.1);
    }
    .video-container {
        position: relative;
        padding-bottom: 56.25%; /* 16:9 aspect ratio */
        height: 0;
        overflow: hidden;
        border-radius: 10px;
        box-shadow: var(--card-shadow);
        background-color: var(--card-bg);
    }
    .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    .video-title-bar {
        background-color: var(--card-bg);
        padding: 5px 15px;
        border-radius: 10px;
        margin-top: 3px;
        display: flex;
        flex-direction: column; /* Changed to column for title/stats separation */
        gap: 5px; /* Reduced gap */
    }

    .video-title-bar.open {
      border-radius: 10px 10px 0 0;
    }

    .title-and-more-container {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        flex-grow: 1;
        justify-content: center;
    }

    .video-title-bar h1 {
        margin: 0;
        font-size: 18px;
        color: var(--text-primary);
        word-wrap: break-word;
        word-break: break-all;
        font-weight: bold; 
    }
    
    .more-text {
        font-size: 13px;
        color: var(--text-link); 
        margin-top: 2px; 
        font-weight: 500;
        user-select: none;
        cursor: pointer; 
    }
    
    .video-stats {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        gap: 5px;
        background-color: var(--category-bg); /* Single background for all icons */
        border-radius: 10px;
        padding: 8px 12px;
        box-sizing: border-box;
    }

    .card-stats {
        display: flex;
        align-items: center;
        /* Removed individual background for each card-stats */
        justify-content: center;
        white-space: nowrap; 
        overflow: hidden; 
        text-overflow: ellipsis; 
    }

    .card-stats .icon {
        margin-right: 5px;
        width: 20px;
        height: 20px;
        stroke: var(--text-primary); 
    }

    .card-stats .count {
        font-weight: bold;
        color: var(--text-primary); 
        font-size: 14px;
        flex-shrink: 0;
    }

    .love-stats {
        cursor: pointer;
        transition: color 0.2s ease;
        user-select: none;
    }
    .love-stats svg {
        transition: fill 0.2s ease, transform 0.2s ease;
        stroke: var(--text-secondary); 
    }
    .love-stats.liked svg {
        fill: #ff0000;
        stroke: #ff0000;
    }
    .love-stats:hover svg {
        transform: scale(1.1);
    }
    .love-stats:active,
    .love-stats:focus {
        outline: none;
        -webkit-tap-highlight-color: transparent;
    }
    .love-stats:active svg {
        transform: scale(1.1);
        transition: transform 0.2s ease;
    }
    .share-stats:active .icon {
        transform: scale(1.1);
        transition: transform 0.2s ease;
    }
    .loader {
        border: 4px solid #444;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 18px;
        height: 18px;
        animation: spin 1s linear infinite;
        flex-shrink: 0;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    .recommended-section {
        margin-top: 0px;
    }
    .recommended-section h2 {
        font-size: 20px;
        margin: 0;
        padding: 10px;
        text-align: center;
        color: var(--text-primary);
        background-color: var(--card-bg);
        border-radius: 10px;
        margin-bottom: 5px;
    }
    .container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        padding: 10px; 
    }
    .card {
        background-color: var(--card-bg); 
        border-radius: 15px;
        box-shadow: var(--card-shadow);
        overflow: hidden;
        display: flex;
        flex-direction: column; 
        justify-content: space-between;
        transition: box-shadow 0.3s ease;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease-out, transform 0.6s ease-out, box-shadow 0.3s ease;
    }
    .card.visible {
        opacity: 1;
        transform: translateY(0);
    }
    .card:hover {
        box-shadow: var(--card-hover-shadow);
    }
    .card:active {
        box-shadow: var(--card-hover-shadow); 
    }
    .card-header {
        position: relative;
        width: 100%;
    }
    .share-icon {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: rgba(0, 0, 0, 0.5);
        color: #fff;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        z-index: 5;
    }
    .share-icon:hover {
        background-color: rgba(0, 0, 0, 0.7);
    }
    .card-upload-time {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: rgba(0, 0, 0, 0.5);
        color: #fff;
        padding: 5px 8px;
        border-radius: 5px;
        font-size: 12px;
        z-index: 5;
        white-space: nowrap;
    }
    .card-image-container {
        position: relative;
        width: 100%;
        height: 150px;
        overflow: hidden;
        border-radius: 15px 15px 0 0;
        cursor: pointer;
    }
    .play-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 50px;
        height: 50px;
        background-color: rgba(0, 0, 0, 0.6);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2;
        transition: background-color 0.3s ease;
    }
    .play-icon:hover {
        background-color: rgba(0, 0, 0, 0.8);
    }
    .play-icon svg {
        fill: #fff;
        width: 25px;
        height: 25px;
    }
    .card-image-container img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .card-content {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 10px;
    }
    .card-title {
        font-size: 16px;
        color: var(--text-primary); 
        margin: 0;
        white-space: normal;
        word-wrap: break-word;
    }
    .card-divider {
        height: 1.5px;
        width: 80%;
        background-color: var(--divider-color); 
        margin: 5px 0;
    }
    .card-footer {
        display: flex;
        align-items: center;
        justify-content: space-between; /* দুটি আইকনের মাঝে পর্যাপ্ত ফাঁকা স্থান তৈরি করা হয়েছে */
        padding: 0 10px 10px 10px;
        box-sizing: border-box;
    }
    .notification {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(40, 167, 69, 0.9);
        color: white;
        padding: 10px 15px;
        border-radius: 5px;
        z-index: 1002;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
        text-align: center;
        box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.2);
        font-size: 14px;
        max-width: 90%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        visibility: hidden;
        pointer-events: none;
    }
    .notification.error {
        background-color: rgba(220, 53, 69, 0.9);
    }
    .notification.show {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
    }

    /* Description Styles (New Dropdown/Push Down) */
    .description-container {
        max-height: 0;
        overflow: hidden;
        background-color: var(--card-bg);
        padding: 0 15px;
        border-radius: 0 0 10px 10px;
        transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .description-container.active {
        max-height: 1000px; /* প্রয়োজন অনুযায়ী মান পরিবর্তন করা হয়েছে */
        padding: 15px;
    }

    .description-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .description-header h2 {
        font-size: 18px;
        font-weight: bold;
        color: var(--text-primary);
        margin: 0;
    }

    .close-icon {
        width: 24px;
        height: 24px;
        cursor: pointer;
        transition: transform 0.2s ease; /* জুম ইফেক্টের জন্য transition */
    }
    
    .close-icon:focus,
    .close-icon:active {
        outline: none; /* নীল আউটলাইন অপসারণ করা হয়েছে */
        transform: scale(1.1); /* ক্লিকের সময় জুম ইফেক্ট যোগ করা হয়েছে */
    }

    .close-icon svg {
        fill: var(--text-primary);
    }

    .panel-divider {
        border: none;
        border-top: 1px solid var(--divider-color);
        margin: 10px 0;
    }

    .description-content {
        line-height: 1.6;
        padding-bottom: 20px; /* ডিসক্রিপশনের নিচের ফাঁকা স্থান বাড়ানো হয়েছে */
    }

    #description-content p {
        margin: 0 0 12px 0;
        color: var(--text-secondary);
        font-size: 14px;
    }
    #description-content ul {
        margin: 0 0 12px 20px;
        color: var(--text-secondary);
        font-size: 14px;
    }
    #description-content .highlight {
        font-weight: 700;
        color: #e74c3c;
    }

    /* Transition effect for pushing content */
    #recommended-section {
        transition: margin-top 0.3s ease;
    }
    
    .video-title-bar {
        transition: border-radius 0.3s ease;
    }


    @media (max-width: 767px) {
        .header { padding: 8px 10px; gap: 5px; }
        .website-name { font-size: 16px; }
        .website-icon { width: 20px; height: 20px; }
        .social-icon { width: 20px; height: 20px; }
        #main-content {
            padding: 5px;
        }
        .video-title-bar {
            padding: 10px;
        }
        .video-title-bar h1 {
            font-size: 16px;
        }
        .container {
            grid-template-columns: 1fr 1fr; 
            gap: 10px;
            padding: 5px; 
        }
        .card-title { font-size: 14px; }
        .card-image-container { height: 130px; }
        .card-upload-time {
            font-size: 10px;
            top: 8px;
            left: 8px;
            padding: 4px 6px;
        }
    }
    
    /*======================================
     ফুটার স্টাইল (নতুন)
    ======================================*/
    footer {
        background-color: var(--footer-bg);
        color: var(--text-secondary);
        text-align: center;
        padding: 20px 10px;
        margin-top: 20px; 
        position: relative; 
        width: 100%;
        box-sizing: border-box;
    }

    .footer-links {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 15px;
    }

    .footer-links a {
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 14px;
        transition: color 0.3s ease;
    }

    .footer-links a:hover {
        color: var(--text-primary);
    }

    .footer-copyright p {
        margin: 0;
        font-size: 12px;
    }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <div class="website-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M17 7h-4V4h4c2.21 0 4 1.79 4 4v4h-2V8c0-1.1-.9-2-2-2zm-6 8H7c-1.1 0-2-.9-2-2V9h2V7H7c-2.21 0-4 1.79-4 4v4c0 2.21 1.79 4 4 4h4v-2zm-1 3H7c-1.1 0-2-.9-2-2V9h2V7h2v2h4v2H9c-.55 0-1-.45-1-1s.45-1 1-1h4v2H9c-1.66 0-3 1.34-3 3v2c0 1.1.9 2 2 2h3v-2z"/>
                </svg>
            </div>
            <div class="website-name">
                <span class="name-part-1">Secret</span><span class="name-part-2">Binodon</span>
            </div>
        </div>
        <div class="header-right">
            <div class="social-icons-container">
                <a href="https://t.me/virallink_market" target="_blank" class="social-icon">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram">
                </a>
                <a href="#" target="_blank" class="social-icon">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/b/b8/2021_Facebook_icon.svg" alt="Facebook">
                </a>
                <a href="https://wa.me/" target="_blank" class="social-icon">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
                </a>
            </div>
        </div>
    </header>

    <main id="main-content">
        <div id="video-embed-section">
            <div class="video-container" id="video-container">
                </div>
            
            <div class="video-title-bar" id="video-title-bar">
                <div class="title-and-more-container">
                    <h1 id="video-title">Loading...</h1>
                    <p class="more-text" id="open-description-btn">Description: more...</p>
                </div>
                <div class="video-stats">
                    <div class="card-stats view-stats">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-eye">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        <span class="count"><div class="loader"></div></span>
                    </div>
                    <div class="card-stats share-stats">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-box-arrow-up" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M3.5 6a.5.5 0 0 0-.5.5v8a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5v-8a.5.5 0 0 0-.5-.5h-2a.5.5 0 0 1 0-1h2A1.5 1.5 0 0 1 14 6.5v8a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 14.5v-8A1.5 1.5 0 0 1 3.5 5h2a.5.5 0 0 1 0 1h-2z"/>
                            <path fill-rule="evenodd" d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V9.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
                        </svg>
                    </div>
                    <div class="card-stats love-stats" data-id="">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#6c757d" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-heart">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                        </svg>
                        <span class="count"><div class="loader"></div></span>
                    </div>
                </div>
            </div>
            
            <div class="description-container" id="description-container">
                <div class="description-header">
                    <h2>Disclaimer &amp; Content Information</h2>
                    <div class="close-icon" id="close-description-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </div>
                </div>
                <hr class="panel-divider">
                <div class="description-content" id="description-content">
                    <p>
                        All videos available on this platform are intended for adult audiences aged 18 years and above.
                        The content provided here is for <span class="highlight">educational, entertainment, and legal purposes only</span>.
                        We strictly avoid any copyrighted or illegal material.
                    </p>
                    <p>
                        The videos you see are uploaded in accordance with all applicable laws, and we do not take responsibility for content
                        originating outside this platform. By accessing this content, you confirm that you are 18 years or older and consent to viewing
                        adult material.
                    </p>
                    <p>
                        Please note: Any inappropriate or illegal usage of content from this platform is strictly prohibited. We encourage responsible viewing.
                        All content is monitored and presented under safe guidelines to ensure compliance with applicable policies and ad network rules.
                    </p>

                    <p><span class="highlight">Important Points:</span></p>
                    <ul>
                        <li>No copyrighted content is used.</li>
                        <li>All content is legally shared and safe for adults.</li>
                        <li>Viewer discretion is advised.</li>
                        <li>The platform maintains compliance with ad network policies to ensure ads can run safely.</li>
                    </ul>

                    <p>
                        This description is universal and will appear on all videos, ensuring that both viewers and ad networks understand the content
                        is <span class="highlight">safe, legal, and age-restricted</span>.
                    </p>
                </div>
            </div>
        </div>

        <div class="ad-container">
            <script async="async" data-cfasync="false" src="//pl27703152.revenuecpmgate.com/247476cdf6d68a31797ec615e7b10572/invoke.js"></script>
            <div id="container-247476cdf6d68a31797ec615e7b10572"></div>
        </div>
        
        <div class="recommended-section" id="recommended-section">
            <h2>⬇️ আপনার জন্য নির্বাচিত কিছু ভিডিও ⬇️</h2>
            <div class="container" id="recommended-container">
                </div>
        </div>
    </main>
    
    <div id="notificationPopup" class="notification"></div>

    <footer>
        <div class="footer-links">
            <a href="#">About Us</a>
            <a href="#">Terms & Conditions</a>
            <a href="#">Privacy Policy</a>
        </div>
        <div class="footer-copyright">
            <p>&copy; 2024 Your Website Name. All Rights Reserved.</p>
        </div>
    </footer>

    <script type="module">
        // সরাসরি লিংকে প্রবেশ বন্ধ করার জন্য এই কোডটি যুক্ত করা হয়েছে
        const allowedOrigin = window.location.origin;
        const referrer = document.referrer;

        if (referrer === '' || !referrer.startsWith(allowedOrigin)) {
            // window.location.href = allowedOrigin + '/link/';
        }
        
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, increment, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

        // Firebase কনফিগারেশন
        const firebaseConfig = {
            apiKey: "AIzaSyCAsD8wucLsudzY5oNbiixLGyjN2apdV0Q",
            authDomain: "my-ad-analytics-4560a.firebaseapp.com",
            databaseURL: "https://my-ad-analytics-4560a-default-rtdb.firebaseio.com",
            projectId: "my-ad-analytics-4560a",
            storageBucket: "my-ad-analytics-4560a.firebasestorage.app",
            messagingSenderId: "104213283950",
            appId: "1:104213283950:web:b5a25ecd54df809625127f",
            measurementId: "G-WS7QSQ9H0Y"
        };

        // Firebase ইনিশিয়ালাইজ করা
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let allCardData = [];
        let cardId = null;
        let viewUpdated = false;

        const videoTitleEl = document.getElementById('video-title');
        const videoContainer = document.getElementById('video-container');
        const recommendedContainer = document.getElementById('recommended-container');
        const notificationPopup = document.getElementById('notificationPopup');
        const videoViewCountEl = document.querySelector('.video-stats .view-stats .count');
        const videoLoveCountEl = document.querySelector('.video-stats .love-stats .count');
        const videoLoveStatsBtn = document.querySelector('.video-stats .love-stats');
        
        // ডিসক্রিপশনের জন্য ব্যবহৃত উপাদান
        const videoTitleBar = document.getElementById('video-title-bar');
        const openDescriptionBtn = document.getElementById('open-description-btn');
        const closeDescriptionBtn = document.getElementById('close-description-btn');
        const descriptionContainer = document.getElementById('description-container');
        const descriptionContent = document.getElementById('description-content');

        // ডিভাইসের আইডি তৈরি বা লোড করা
        function getDeviceId() {
            let deviceId = localStorage.getItem('deviceId');
            if (!deviceId) {
                deviceId = 'device-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('deviceId', deviceId);
            }
            return deviceId;
        }
        const deviceId = getDeviceId();

        // সময়কে সহজে পড়ার মতো ফরম্যাটে রূপান্তর
        function formatTimeAgo(timestamp) {
            const uploadDate = new Date(timestamp);
            const now = new Date();
            const seconds = Math.floor((now - uploadDate) / 1000);
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + " বছর আগে";
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + " মাস আগে";
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + " দিন আগে";
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + " ঘন্টা আগে";
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + " মিনিট আগে";
            return "এখনই";
        }
        
        // বড় সংখ্যাকে ছোট ফরম্যাটে রূপান্তর
        function formatCount(num) {
            if (num >= 1000000000) return (num / 1000000000).toFixed(1).replace(/\.0$/, '') + 'B';
            if (num >= 1000000) return (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'K';
            return num;
        }

        // নোটিফিকেশন দেখানো
        function showNotification(message, duration = 3000, isError = false) {
            notificationPopup.textContent = message;
            if (isError) {
                notificationPopup.classList.add('error');
            } else {
                notificationPopup.classList.remove('error');
            }
            notificationPopup.classList.add('show');
            setTimeout(() => {
                notificationPopup.classList.remove('show');
            }, duration);
        }
        
        // ভিউ কাউন্ট আপডেট করা
        async function updateViewCount(id) {
            if (viewUpdated) return;
            const viewsRef = doc(db, "views", id);
            try {
                await setDoc(viewsRef, { count: increment(1) }, { merge: true });
                viewUpdated = true;
                console.log(`View count for ${id} updated.`);
            } catch (error) {
                console.error("Error updating view count:", error);
                showNotification('Failed to update view count.', 3000, true);
            }
        }

        // লাইভ ডেটা এবং স্ট্যাটাস আপডেট করা
        function getAndUpdateStats(id, viewEl, loveEl, loveBtn) {
            if (!id) return;
            
            const viewsDocRef = doc(db, "views", id);
            const lovesDocRef = doc(db, "loves", id);
            const userLikedDocRef = doc(db, `loves/${id}/users`, deviceId);

            // Fetch and display initial data immediately, then listen for updates
            const fetchInitialData = async () => {
                try {
                    const [viewsSnap, lovesSnap, userLikedSnap] = await Promise.all([
                        getDoc(viewsDocRef),
                        getDoc(lovesDocRef),
                        getDoc(userLikedDocRef)
                    ]);

                    const viewCount = viewsSnap.exists() ? viewsSnap.data().count : 0;
                    if (viewEl) viewEl.textContent = formatCount(viewCount);

                    const loveCount = lovesSnap.exists() ? lovesSnap.data().count : 0;
                    if (loveEl) loveEl.textContent = formatCount(loveCount);

                    if (loveBtn && userLikedSnap.exists()) {
                        loveBtn.classList.add('liked');
                    }
                } catch (error) {
                    console.error("Error fetching initial stats:", error);
                    if (viewEl) viewEl.textContent = 'Error';
                    if (loveEl) loveEl.textContent = 'Error';
                }
            };

            fetchInitialData();

            // Set up real-time listeners for updates
            onSnapshot(viewsDocRef, (docSnap) => {
                const viewCount = docSnap.exists() ? docSnap.data().count : 0;
                if (viewEl) viewEl.textContent = formatCount(viewCount);
            }, (error) => {
                console.error("Error getting views:", error);
                if (viewEl) viewEl.textContent = 'Error';
            });
            
            onSnapshot(lovesDocRef, (docSnap) => {
                const loveCount = docSnap.exists() ? docSnap.data().count : 0;
                if (loveEl) loveEl.textContent = formatCount(loveCount);
            }, (error) => {
                console.error("Error getting loves:", error);
                if (loveEl) loveEl.textContent = 'Error';
            });
        }
        
        // লাইক কাউন্ট আপডেট করা
        async function updateLoveCount(id, loveStatsBtn) {
            const userLikedDocRef = doc(db, `loves/${id}/users`, deviceId);
            try {
                const docSnap = await getDoc(userLikedDocRef);
                if (docSnap.exists()) {
                    showNotification("আপনি ইতিমধ্যেই লাইক করেছেন 😍।", 3000, true);
                    loveStatsBtn.classList.add('liked'); 
                } else {
                    showNotification("লাইক দেওয়ার জন্য ধন্যবাদ 🤝", 2000);
                    loveStatsBtn.classList.add('liked'); 
                    
                    await setDoc(doc(db, "loves", id), { count: increment(1) }, { merge: true });
                    await setDoc(userLikedDocRef, { timestamp: new Date() });
                }
            } catch (error) {
                console.error("Error updating love count:", error);
                showNotification("লাইক আপডেট করা যায়নি। আবার চেষ্টা করুন।", 3000, true);
                loveStatsBtn.classList.remove('liked');
            }
        }

        // কার্ড তৈরি করার ফাংশন
        function createCard(data) {
            const card = document.createElement('div');
            card.classList.add('card');
            card.setAttribute('data-id', data.id);
            
            const timeAgoText = data.uploadTime ? formatTimeAgo(data.uploadTime) : '';
            
            card.innerHTML = `
                <div class="card-header">
                    <div class="share-icon" data-id="${data.id}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-box-arrow-up" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M3.5 6a.5.5 0 0 0-.5.5v8a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5v-8a.5.5 0 0 0-.5-.5h-2a.5.5 0 0 1 0-1h2A1.5 1.5 0 0 1 14 6.5v8a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 14.5v-8A1.5 1.5 0 0 1 3.5 5h2a.5.5 0 0 1 0 1h-2z"/>
                            <path fill-rule="evenodd" d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V9.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
                        </svg>
                    </div>
                    <div class="card-upload-time">${timeAgoText}</div>
                    <div class="card-image-container">
                        <img src="${data.image}" alt="${data.title}" loading="lazy">
                        <div class="play-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z" />
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="card-content">
                    <h3 class="card-title">${data.title}</h3>
                    <hr class="card-divider">
                </div>
                <div class="card-footer">
                    <div class="card-stats view-stats">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-eye">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        <span class="count"><div class="loader"></div></span>
                    </div>
                    <div class="card-stats love-stats" data-id="${data.id}">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#6c757d" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-heart">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                        </svg>
                        <span class="count"><div class="loader"></div></span>
                    </div>
                </div>`;
            return card;
        }

        // কার্ডগুলো রেন্ডার করার ফাংশন
        function renderCards(cardsToRender) {
            recommendedContainer.innerHTML = '';
            cardsToRender.forEach(data => {
                const card = createCard(data);
                recommendedContainer.appendChild(card);
                getAndUpdateStats(data.id, card.querySelector('.view-stats .count'), card.querySelector('.love-stats .count'), card.querySelector('.love-stats'));
                setTimeout(() => {
                    card.classList.add('visible');
                }, 50);
            });
        }

        // ডেটা লোড এবং রেন্ডার করা
        async function loadDataAndRender() {
            try {
                const response = await fetch('cards.json');
                if (!response.ok) throw new Error('Network response was not ok');
                allCardData = await response.json();
                
                const urlParams = new URLSearchParams(window.location.search);
                cardId = urlParams.get('cardId');
                
                const currentCardData = allCardData.find(card => card.id === cardId);
                
                if (currentCardData) {
                    videoTitleEl.textContent = currentCardData.title;
                    videoContainer.innerHTML = currentCardData.embed_code;

                    getAndUpdateStats(cardId, videoViewCountEl, videoLoveCountEl, videoLoveStatsBtn);

                    const videoObserver = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                updateViewCount(cardId);
                                videoObserver.unobserve(entry.target);
                            }
                        });
                    }, { threshold: 0.5 });
                    
                    videoObserver.observe(videoContainer);

                    const recommendedCards = allCardData
                        .filter(card => card.id !== cardId)
                        .sort(() => 0.5 - Math.random())
                        .slice(0, 6); 
                    renderCards(recommendedCards);
                    
                } else {
                    videoTitleEl.textContent = "ভিডিও খুঁজে পাওয়া যায়নি।";
                    showNotification("ভিডিও খুঁজে পাওয়া যায়নি!", 3000, true);
                }
            } catch (error) {
                console.error('Error loading data:', error);
                videoTitleEl.textContent = "Error loading video.";
                showNotification("ডেটা লোড করা যায়নি। অনুগ্রহ করে আবার চেষ্টা করুন।", 5000, true);
            }
        }
        
        // ডিসক্রিপশন প্যানেল খোলার জন্য ইভেন্ট লিসনার
        openDescriptionBtn.addEventListener('click', () => {
            descriptionContainer.classList.add('active');
            videoTitleBar.classList.add('open');
            openDescriptionBtn.style.display = 'none';
        });

        // ডিসক্রিপশন প্যানেল বন্ধ করার জন্য ইভেন্ট লিসনার
        closeDescriptionBtn.addEventListener('click', () => {
            descriptionContainer.classList.remove('active');
            videoTitleBar.classList.remove('open');
            openDescriptionBtn.style.display = 'block';
        });

        // অন্যান্য সাধারণ ইভেন্ট লিসনার
        document.addEventListener('click', (event) => {
            const shareIcon = event.target.closest('.share-icon');
            const loveStats = event.target.closest('.love-stats');
            const imageContainer = event.target.closest('.card-image-container');

            if (shareIcon) {
                const cardId = shareIcon.dataset.id;
                const cardTitle = shareIcon.closest('.card').querySelector('.card-title').textContent;
                const shareUrl = `${window.location.origin}/link/?cardId=${cardId}`;
                
                if (navigator.share) {
                    navigator.share({
                        title: cardTitle,
                        text: `${cardTitle} ভাইরাল ভিডিওটি দেখতে 👇 লিংকে ক্লিক করুন!`,
                        url: shareUrl,
                    });
                } else {
                    navigator.clipboard.writeText(shareUrl);
                    showNotification("লিঙ্ক কপি করা হয়েছে!", 2000);
                }
                return;
            }
            
            const mainShareIcon = event.target.closest('.share-stats');
            if (mainShareIcon) {
                const videoTitle = document.getElementById('video-title').textContent;
                const shareUrl = `${window.location.origin}/link/?cardId=${cardId}`;
                
                if (navigator.share) {
                    navigator.share({
                        title: videoTitle,
                        text: `${videoTitle} ভাইরাল ভিডিওটি দেখতে 👇 লিংকে ক্লিক করুন!`,
                        url: shareUrl,
                    });
                } else {
                    navigator.clipboard.writeText(shareUrl);
                    showNotification("লিঙ্ক কপি করা হয়েছে!", 2000);
                }
                return;
            }

            if (loveStats) {
                const cardId = loveStats.dataset.id;
                if (cardId) {
                    updateLoveCount(cardId, loveStats);
                }
                return;
            }

            if (imageContainer) {
                const card = imageContainer.closest('.card');
                const cardId = card.dataset.id;
                window.location.href = `step2.html?cardId=${cardId}`;
            }
        });

        // মূল লাইক বাটনে ক্লিক করার জন্য ইভেন্ট লিসনার
        videoLoveStatsBtn.addEventListener('click', () => {
            if (cardId) {
                updateLoveCount(cardId, videoLoveStatsBtn);
            }
        });

        loadDataAndRender();
    </script>
</body>
</html>
