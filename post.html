
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filmixo - Premium Movie Access</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- CORE & RESET --- */
        :root { --primary: #1da1f2; --dark: #0f1419; --light: #536471; --border: #e1e8ed; --bg: #fff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; text-decoration: none; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); display: flex; justify-content: center; overflow-x: hidden; }

        /* --- WRAPPER & ANIMATIONS --- */
        .main-wrapper { width: 100%; max-width: 600px; min-height: 100vh; background: var(--bg); border-left: 1px solid #eee; border-right: 1px solid #eee; opacity: 0; transition: opacity 0.4s ease; position: relative; }
        .main-wrapper.loaded { opacity: 1 !important; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes shine { 0% { left: -100%; } 100% { left: 100%; } }
        @keyframes pulse-gold { 0% { box-shadow: 0 0 0 0 rgba(218, 165, 32, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(218, 165, 32, 0); } 100% { box-shadow: 0 0 0 0 rgba(218, 165, 32, 0); } }

        /* --- HEADER --- */
        header { background: var(--primary); padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; color: white; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .logo-area { font-weight: 900; font-size: 20px; letter-spacing: 1px; text-transform: uppercase; }
        .header-btn { background: white; color: var(--primary); padding: 6px 16px; border-radius: 20px; font-weight: 700; font-size: 13px; margin-left: 8px; cursor: pointer; transition: transform 0.2s; }
        .header-btn:active { transform: scale(0.95); }

        /* --- POST META --- */
        .post-author-area { padding: 10px 15px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); }
        .author-info { display: flex; align-items: center; gap: 10px; }
        .pfp { width: 42px; height: 42px; border-radius: 50%; background: #ddd; overflow: hidden; }
        .pfp img { width: 100%; height: 100%; object-fit: cover; }
        .author-text h3 { font-size: 16px; color: var(--dark); display: inline-flex; align-items: center; margin: 0; }
        .author-text span { font-size: 14px; color: var(--primary); display: block; margin-top: -2px; }
        .verified-badge { color: var(--primary); font-size: 14px; margin-left: 4px; }
        .post-time { font-size: 13px; color: var(--light); font-weight: 600; }

        /* --- VIDEO PLAYER --- */
        .video-container { width: 100%; aspect-ratio: 16/9; background: #000; position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden; margin-top: 5px; cursor: pointer; }
        .video-container img { width: 100%; height: 100%; object-fit: contain; }
        .play-btn-center { position: absolute; width: 55px; height: 55px; background: rgba(0,0,0,0.6); border-radius: 50%; border: 3px solid #fff; display: flex; align-items: center; justify-content: center; z-index: 5; pointer-events: none; }
        .play-btn-center::after { content: ''; border-left: 18px solid white; border-top: 10px solid transparent; border-bottom: 10px solid transparent; margin-left: 4px; }
        .main-video-spinner { display: none; position: absolute; width: 45px; height: 45px; border: 4px solid rgba(255, 255, 255, 0.3); border-top: 4px solid #fff; border-radius: 50%; animation: spin 1s linear infinite; z-index: 6; }
        .video-controls { position: absolute; bottom: 0; left: 0; width: 100%; padding: 8px 12px; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: white; display: flex; justify-content: space-between; font-size: 12px; font-weight: 600; z-index: 5; }

        /* --- CONTENT --- */
        .content-body { padding: 15px; }
        .article-title { font-size: 19px; font-weight: 800; margin-bottom: 12px; color: var(--dark); line-height: 1.3; }
        .article-para { font-size: 15px; line-height: 1.4; color: #1c1e21; margin-bottom: 10px; text-align: left; }

        /* --- DOWNLOAD BUTTONS & LOGIC UI --- */
        .download-title-text { font-size: 17px; font-weight: 800; color: var(--dark); text-align: center; margin: 20px 0 12px 0; padding-top: 15px; border-top: 1px solid var(--border); letter-spacing: -0.5px; }
        .download-buttons-container { display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px; }
        
        /* Normal Step Buttons */
        .download-btn-v2 { display: flex; align-items: center; justify-content: center; width: 100%; padding: 14px 10px; border-radius: 10px; font-weight: 700; font-size: 15px; color: white; cursor: pointer; text-transform: uppercase; box-shadow: 0 4px 10px rgba(0,0,0,0.15); transition: transform 0.2s, box-shadow 0.2s; position: relative; overflow: hidden; }
        .download-btn-v2:active { transform: scale(0.98); }
        .download-btn-v2 i.left-icon { margin-right: 8px; }

        /* Completed Step Style */
        .download-btn-v2.completed-step { cursor: default; pointer-events: none; }
        
        /* Right Side Checkmark Logic */
        .download-btn-v2 .check-icon { 
            margin-left: 12px; /* Gap from text */
            color: #1da1f2; /* Verified Blue */
            background: white; 
            border-radius: 50%; 
            width: 20px; height: 20px; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 12px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border: 2px solid white; /* Outline for visibility on any bg */
        }

        /* ðŸ”¥ ULTRA-LUXURY FINAL BUTTON ðŸ”¥ */
        .final-download-btn {
            display: none; /* Initially Hidden */
            background: linear-gradient(135deg, #FFD700 0%, #FDB931 25%, #996515 50%, #FDB931 75%, #FFD700 100%);
            color: #3e2723 !important;
            border: 1px solid #fff;
            font-size: 16px;
            font-weight: 900;
            letter-spacing: 1.5px;
            text-shadow: 0px 1px 0px rgba(255,255,255,0.4);
            box-shadow: 0 0 15px rgba(218, 165, 32, 0.5), inset 0 0 10px rgba(255, 255, 255, 0.4);
            animation: pulse-gold 2s infinite;
            flex-direction: column; /* For potential subtext, optional */
            padding: 16px;
        }
        .final-download-btn::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
            background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.6) 50%, rgba(255,255,255,0) 100%);
            transform: skewX(-25deg); animation: shine 3s infinite;
        }
        .final-btn-content { display: flex; align-items: center; gap: 10px; z-index: 2; }

        /* --- STATS & FOOTER --- */
        .stats-section { padding: 12px 0; margin-top: 15px; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); display: flex; align-items: center; }
        .stats-left { display: flex; gap: 20px; flex-grow: 1; }
        .view-stat, .love-btn { display: flex; align-items: center; gap: 6px; font-weight: 500; font-size: 14px; color: var(--light); cursor: pointer; }
        .love-btn.liked { color: #e0245e; } 
        .share-icons { display: flex; gap: 10px; }
        .share-icon { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; cursor: pointer; transition: transform 0.2s; }
        .share-icon:hover { transform: scale(1.1); }

        /* --- RELATED POSTS --- */
        .related-header { padding: 15px; font-weight: 800; color: var(--light); border-bottom: 1px solid var(--border); text-transform: uppercase; letter-spacing: 0.5px; font-size: 14px; }
        .post-card { padding: 10px 15px; border-bottom: 1px solid var(--border); display: flex; flex-direction: column; gap: 8px; }
        .post-header { display: flex; gap: 10px; align-items: center; }
        .name-row { display: flex; align-items: center; gap: 5px; flex-wrap: wrap; }
        .name-row h3 { font-size: 16px; font-weight: 800; color: var(--dark); margin: 0; }
        .post-username { font-size: 14px; color: var(--primary); }
        .post-title { font-size: 16px; font-weight: 700; color: var(--dark); line-height: 1.3; margin: 4px 0; cursor: pointer; }
        .post-excerpt { font-size: 14px; color: var(--dark); line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; cursor: pointer; }
        .read-more-text { color: var(--primary); font-weight: 600; font-size: 13px; }
        .hashtags { color: #1d9bf0; font-size: 14px; cursor: default; }
        .media-container { position: relative; width: 100%; border-radius: 12px; overflow: hidden; background: #000; aspect-ratio: 3/4; cursor: pointer; }
        .media-container img { width: 100%; height: 100%; object-fit: cover; }
        .media-container.auto-fit { aspect-ratio: initial; height: auto; }
        .media-container.auto-fit img { height: auto; object-fit: contain; }
        .play-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; background: rgba(0,0,0,0.6); border-radius: 50%; display: flex; justify-content: center; align-items: center; border: 2px solid rgba(255,255,255,0.8); pointer-events: none; }
        .play-icon::after { content: ''; border-left: 16px solid white; border-top: 9px solid transparent; border-bottom: 9px solid transparent; margin-left: 4px; }
        .duration-badge { position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.75); color: white; padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: 700; pointer-events: none; }
        .post-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; color: var(--light); font-size: 13px; font-weight: 500; }
        .footer-right { display: flex; align-items: center; gap: 15px; }

        /* --- SITE FOOTER & MISC --- */
        .site-footer { padding: 40px 20px; text-align: center; color: var(--light); }
        .footer-links { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin-bottom: 15px; }
        .footer-links a { color: var(--light); font-size: 13px; font-weight: 500; }
        #sentinel { height: 60px; display: flex; align-items: center; justify-content: center; }
        .load-more-spinner { width: 24px; height: 24px; border: 3px solid #ccc; border-top: 3px solid var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; display: none; }
        #sentinel.loading .load-more-spinner { display: block; }
        
        .notification { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.95); color: white; padding: 12px 24px; border-radius: 50px; z-index: 2000; opacity: 0; transition: opacity 0.3s; pointer-events: none; font-weight: 600; font-size: 14px; text-align: center; width: max-content; max-width: 90%; box-shadow: 0 5px 20px rgba(0,0,0,0.4); }
        .notification.show { opacity: 1; }
    </style>
</head>
<body>

<div class="main-wrapper">
    <header>
        <div class="logo-area">FILMIXO</div>
        <div>
            <span class="header-btn" onclick="window.location.href='https://prototypesorting.com/p99vwjq2?key=57217116cccb25526dfb6a5a4edd9aea'">Sign Up</span>
            <span class="header-btn" onclick="window.location.href='index.html'">Home</span>
        </div>
    </header>

    <div id="post-details-container"></div>

    <div class="related-section" id="related-section-id">
        <div class="related-header">Related Posts</div>
        <div id="related-posts-container"></div>
        <div id="sentinel"><div class="load-more-spinner"></div></div>
    </div>

    <footer class="site-footer">
        <div class="footer-links">
            <a href="#">About</a><a href="#">Contact</a><a href="#">Privacy</a><a href="#">Terms</a>
        </div>
        <div class="footer-copyright">Copyright Â© 2026 <a href="index.html" style="color:var(--primary)">Filmixo.com</a></div>
    </footer>
    <div id="notification" class="notification"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, increment, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

    // --- CONFIG & STATE ---
    const CONFIG = {
        VIDEO_REDIRECT: "https://prototypesorting.com/p99vwjq2?key=57217116cccb25526dfb6a5a4edd9aea",
        VISIT_TIME_MS: 5000,
        BATCH_SIZE: 6,
        PFP_URL: "https://raw.githubusercontent.com/Filmixo/movie/refs/heads/main/Image Files/FILMIXO.jpg"
    };
    
    const db = getFirestore(initializeApp({ apiKey: "AIzaSyCAsD8wucLsudzY5oNbiixLGyjN2apdV0Q", authDomain: "my-ad-analytics-4560a.firebaseapp.com", projectId: "my-ad-analytics-4560a", storageBucket: "my-ad-analytics-4560a.firebasestorage.app", messagingSenderId: "104213283950", appId: "1:104213283950:web:b5a25ecd54df809625127f" }));
    
    let availablePosts = [], currentIndex = 0, timeElements = [], deviceId = localStorage.getItem('did') || `d-${Date.now()}`;
    if(!localStorage.getItem('did')) localStorage.setItem('did', deviceId);

    const urlParams = new URLSearchParams(window.location.search);
    const postId = urlParams.get('id');
    const KEYS = {
        PENDING: `p_click_${postId}`,
        TIME: `p_time_${postId}`,
        VISITED: (id) => `v_${id}_${postId}`
    };

    // --- UTILS ---
    const randColor = () => ['#1da1f2','#e0245e','#17bf63','#794bc4'][Math.floor(Math.random()*4)];
    const fmtCount = n => n >= 1e6 ? (n/1e6).toFixed(1)+'M' : n >= 1e3 ? (n/1e3).toFixed(1)+'K' : (n||0);
    const timeAgo = d => {
        const s = Math.floor((new Date() - new Date(d))/1000);
        return s>31536000?Math.floor(s/31536000)+"y ago":s>86400?Math.floor(s/86400)+"d ago":s>3600?Math.floor(s/3600)+"h ago":s>60?Math.floor(s/60)+"m ago":"Just now";
    };
    const showToast = m => { const n = document.getElementById('notification'); n.innerText = m; n.classList.add('show'); setTimeout(()=>n.classList.remove('show'), 4000); };

    // --- LOGIC: VISIT VERIFICATION ---
    function checkVisit() {
        const pBtn = localStorage.getItem(KEYS.PENDING);
        const pTime = localStorage.getItem(KEYS.TIME);
        if (pBtn && pTime) {
            if (Date.now() - parseInt(pTime) >= CONFIG.VISIT_TIME_MS) {
                localStorage.setItem(KEYS.VISITED(pBtn), '1');
            } else {
                showToast("Please stay on the new page for at least 10 seconds! â³");
            }
            localStorage.removeItem(KEYS.PENDING);
            localStorage.removeItem(KEYS.TIME);
        }
        updateUI();
    }

    window.handleClick = (id, url) => {
        if (localStorage.getItem(KEYS.VISITED(id)) === '1') return;
        localStorage.setItem(KEYS.PENDING, id);
        localStorage.setItem(KEYS.TIME, Date.now());
        window.location.href = url; // Same Tab
    };

    window.finalDl = (url) => {
        ['b1','b2'].forEach(k => localStorage.removeItem(KEYS.VISITED(k)));
        window.location.href = url;
    };

    function updateUI() {
        const b1 = document.getElementById('btn-b1'), b2 = document.getElementById('btn-b2'), final = document.getElementById('btn-final');
        let done = 0, req = 0;
        
        [b1, b2].forEach((b, i) => {
            if(b) {
                req++;
                if(localStorage.getItem(KEYS.VISITED(b.id.split('-')[1])) === '1') {
                    done++;
                    b.innerHTML = `Step ${i+1} Successful <div class="check-icon"><i class="fa-solid fa-check"></i></div>`;
                    b.classList.add('completed-step');
                }
            }
        });

        if(final) final.style.display = (req > 0 && done === req) ? 'flex' : 'none';
    }

    // --- RENDERING ---
    function renderPost(p) {
        let dlHTML = '';
        if (p.downloadLink1 || p.downloadLink2) {
            const finalUrl = p.downloadLink1; 
            dlHTML = `
                <div class="download-title-text">DOWNLOAD FULL MOVIE IN HD</div>
                <div class="download-buttons-container">
                    ${p.downloadLink2 ? `<div id="btn-b1" class="download-btn-v2" style="background:${randColor()}" onclick="handleClick('b1','${p.downloadLink2}')"><i class="fa-solid fa-cloud-arrow-down left-icon"></i> 1080p Full HD</div>` : ''}
                    ${p.downloadLink1 ? `<div id="btn-b2" class="download-btn-v2" style="background:${randColor()}" onclick="handleClick('b2','${p.downloadLink1}')"><i class="fa-solid fa-cloud-arrow-down left-icon"></i> 720p HD</div>` : ''}
                    <div id="btn-final" class="download-btn-v2 final-download-btn" onclick="finalDl('${finalUrl}')">
                        <div class="final-btn-content"><i class="fa-solid fa-crown"></i> DOWNLOAD NOW <i class="fa-solid fa-crown"></i></div>
                    </div>
                </div>`;
        }

        const html = `
            <div class="post-author-area">
                <div class="author-info"><div class="pfp"><img src="${CONFIG.PFP_URL}"></div><div class="author-text"><h3>FILMIXO <i class="verified-badge fa-solid fa-circle-check"></i></h3><span>@filmixo</span></div></div>
                <div class="post-time" id="m-time">${timeAgo(p.uploadTime)}</div>
            </div>
            <div class="video-container" onclick="vidClick()"><img src="${p.mediaImage}"><div class="play-btn-center" id="p-btn"></div><div class="main-video-spinner" id="spin"></div><div class="video-controls"><span>${p.videoDuration}</span><span>HD</span></div></div>
            <div class="content-body">
                <h1 class="article-title">${p.title}</h1>
                ${(p.paragraphs||[]).map(t=>`<p class="article-para">${t}</p>`).join('')}
                ${dlHTML}
                <div class="stats-section">
                    <div class="stats-left"><div class="view-stat"><i class="fa-solid fa-eye"></i> <span id="v-cnt">...</span></div><div class="love-btn"><i class="fa-regular fa-heart"></i> <span id="l-cnt">...</span></div></div>
                    <div class="share-icons">${['facebook-f','facebook-messenger','whatsapp','twitter','telegram'].map((ic,i)=>`<div class="share-icon" style="background:${['#1877f2','#0084ff','#25d366','#1da1f2','#0088cc'][i]}" onclick="share('${['fb','msg','wa','tw','tg'][i]}','${p.title}')"><i class="fa-brands fa-${ic}"></i></div>`).join('')}</div>
                </div>
            </div>`;
        
        document.getElementById('post-details-container').innerHTML = html;
        if(document.getElementById('m-time')) timeElements.push({e:document.getElementById('m-time'), t:p.uploadTime});
        checkVisit();
    }

    function renderCards(list) {
        const c = document.getElementById('related-posts-container');
        list.forEach(p => {
            const div = document.createElement('div');
            div.innerHTML = `
                <div class="post-card">
                    <div class="post-header"><div class="pfp" style="width:35px;height:35px"><img src="${CONFIG.PFP_URL}"></div><div class="name-row"><h3>FILMIXO <i class="verified-badge fa-solid fa-circle-check"></i></h3><span class="post-username">@filmixo</span> &middot; <span class="post-time rel-time" data-t="${p.uploadTime}">${timeAgo(p.uploadTime)}</span></div></div>
                    <div onclick="window.location.href='/movie/post.html?id=${p.id}'">
                        <div class="post-title">${p.title}</div>
                        <div class="post-excerpt">${(p.paragraphs?.[0]||"").substring(0,150)}... <span class="read-more-text">See more</span></div>
                    </div>
                    <div class="hashtags">${p.hashtags}</div>
                    <div class="media-container" onclick="window.location.href='/movie/post.html?id=${p.id}'"><img src="${p.mediaImage}"><div class="play-icon"></div><div class="duration-badge">${p.videoDuration}</div></div>
                    <div class="post-footer"><div class="view-stat"><i class="fa-solid fa-eye"></i> <span class="vc">...</span></div> <div class="footer-right"><div class="love-btn rel-love"><i class="fa-regular fa-heart"></i> <span class="lc">...</span></div><div class="share-icon" style="background:transparent;color:#536471" onclick="sharePost('${p.id}')"><i class="fa-solid fa-share"></i></div></div></div>
                </div>`;
            c.appendChild(div);
            
            const img = div.querySelector('.media-container img');
            img.onload = () => { if(img.naturalWidth/img.naturalHeight >= 0.75) img.parentElement.classList.add('auto-fit'); };
            timeElements.push({e:div.querySelector('.rel-time'), t:p.uploadTime});
            setupFB(p.id, div);
        });
    }

    // --- ACTIONS ---
    window.vidClick = () => { document.getElementById('p-btn').style.display='none'; document.getElementById('spin').style.display='block'; setTimeout(()=>window.location.href=CONFIG.VIDEO_REDIRECT, 200); };
    window.addEventListener('pageshow', () => { document.getElementById('p-btn')&&(document.getElementById('p-btn').style.display='flex',document.getElementById('spin').style.display='none'); checkVisit(); });
    
    window.share = (p, t) => {
        const u = encodeURIComponent(window.location.href), txt = encodeURIComponent(t);
        const ls = {fb:`https://www.facebook.com/sharer/sharer.php?u=${u}`, wa:`https://wa.me/?text=${txt}%20${u}`, tw:`https://twitter.com/intent/tweet?text=${txt}&url=${u}`, tg:`https://t.me/share/url?url=${u}&text=${txt}`};
        if(p==='msg') window.location.href = /Mobi/i.test(navigator.userAgent) ? `fb-messenger://share/?link=${u}` : `https://www.facebook.com/dialog/send?link=${u}&app_id=123&redirect_uri=${u}`;
        else window.open(ls[p], '_blank');
    };
    window.sharePost = (id) => navigator.clipboard.writeText(location.origin+`/movie/post.html?id=${id}`).then(()=>showToast("Link Copied! ðŸ“‹"));

    // --- FIREBASE & INIT ---
    function setupFB(id, el) {
        const vEl = el ? el.querySelector('.vc') : document.getElementById('view-cnt');
        const lEl = el ? el.querySelector('.lc') : document.getElementById('like-cnt');
        const lBtn = el ? el.querySelector('.rel-love') : document.querySelector('.love-btn');
        
        if(!el) setDoc(doc(db,"views",id),{count:increment(1)},{merge:true});
        onSnapshot(doc(db,"views",id), s=>vEl.innerText=fmtCount(s.data()?.count));
        onSnapshot(doc(db,"loves",id), s=>lEl.innerText=fmtCount(s.data()?.count));
        
        const uRef = doc(db,`loves/${id}/users`,deviceId);
        getDoc(uRef).then(s=>{if(s.exists()){lBtn.classList.add('liked');lBtn.querySelector('i').classList.replace('fa-regular','fa-solid')}});
        
        lBtn.onclick = async () => {
            if((await getDoc(uRef)).exists()) return showToast("Already Liked! â¤ï¸");
            lBtn.classList.add('liked'); lBtn.querySelector('i').classList.replace('fa-regular','fa-solid');
            await setDoc(doc(db,"loves",id),{count:increment(1)},{merge:true});
            await setDoc(uRef,{t:new Date()}); showToast("Liked! â¤ï¸");
        };
    }

    (async () => {
        try {
            const res = await fetch('posts.json');
            if(!res.ok) throw 0;
            const posts = await res.json();
            const main = posts.find(p=>p.id===postId) || posts[0];
            renderPost(main); setupFB(main.id);
            document.querySelector('.main-wrapper').classList.add('loaded');
            
            setInterval(()=>timeElements.forEach(x=>x.e&&(x.e.innerText=timeAgo(x.t))), 60000);
            
            const rest = posts.filter(p=>p.id!==main.id && new Date(p.uploadTime)<new Date(main.uploadTime)).sort((a,b)=>new Date(b.uploadTime)-new Date(a.uploadTime));
            availablePosts = rest;
            
            const obs = new IntersectionObserver(e=>{if(e[0].isIntersecting){obs.disconnect(); loadMore();}},{rootMargin:'100px'});
            obs.observe(document.getElementById('related-section-id'));
        } catch(e) { document.getElementById('post-details-container').innerHTML = `<h3 style="text-align:center;padding:20px">Content Unavailable</h3>`; document.querySelector('.main-wrapper').classList.add('loaded'); }
    })();

    function loadMore() {
        const s = document.getElementById('sentinel');
        if(currentIndex >= availablePosts.length) return s.style.display='none';
        s.classList.add('loading');
        setTimeout(() => {
            renderCards(availablePosts.slice(currentIndex, currentIndex + CONFIG.BATCH_SIZE));
            currentIndex += CONFIG.BATCH_SIZE;
            s.classList.remove('loading');
            if(currentIndex < availablePosts.length) {
                new IntersectionObserver(e=>{if(e[0].isIntersecting && !s.classList.contains('loading')) loadMore();},{rootMargin:'100px'}).observe(s);
            } else s.style.display='none';
        }, 500);
    }
</script>
</body>
</html>
